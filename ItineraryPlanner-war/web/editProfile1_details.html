<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- Our Custom CSS -->
    <link rel="stylesheet" href="WEB-INF/css/navbarSidebarModal.css">
</head>

<form id="myform"><!DOCTYPE html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Travellab. Profile</title>
        <!-- Tell the browser to be responsive to screen width -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Font Awesome -->
        <link rel="stylesheet" href="plugins/font-awesome/css/font-awesome.min.css">
        <!-- Theme style -->
        <link rel="stylesheet" href="dist/css/adminlte.min.css">
        <!-- iCheck -->
        <link rel="stylesheet" href="plugins/iCheck/flat/blue.css">
        <!-- jvectormap -->
        <link rel="stylesheet" href="plugins/jvectormap/jquery-jvectormap-1.2.2.css">
        <!-- Date Picker -->
        <link rel="stylesheet" href="plugins/datepicker/datepicker3.css">
        <!-- Daterange picker -->
        <link rel="stylesheet" href="plugins/daterangepicker/daterangepicker-bs3.css">
        <!-- bootstrap wysihtml5 - text editor -->
        <link rel="stylesheet" href="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css">
        <!-- Google Font: Source Sans Pro -->
        <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
    </head>

    <body class="hold-transition sidebar-mini">
        <div class="wrapper">

            <!-- Navbar -->
            <nav class="main-header navbar navbar-expand bg-white navbar-light border-bottom">
                <!-- Left navbar links -->
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" data-widget="pushmenu" href="#"><i class="fa fa-bars"></i></a>
                    </li>
                </ul>


                <!-- Right navbar links -->
                <ul class="navbar-nav ml-auto">
                    <!-- Messages Dropdown Menu -->

                    <li class="nav-item">
                        <a class="nav-link" data-widget="control-sidebar" data-slide="true" href="#"><i
                                class="fa fa-sign-out"></i> Logout</a>
                    </li>
                </ul>
            </nav>
            <!-- /.navbar -->

            <!-- Main Sidebar Container -->
            <aside class="main-sidebar sidebar-dark-primary elevation-4" style="background-color: #00687a;">
                <!-- Brand Logo -->
                <a href="home1.html" class="brand-link" style="font-size: 27px;">
                    <img src="./WEB-INF/logo1.jpg" alt="AdminLTE Logo" class="brand-image img-circle elevation-3"
                         style="opacity: .8">
                    <span class="brand-text font-weight-light" >Travellab</span>
                </a>

                <!-- Sidebar -->
                <div class="sidebar" style="color : black ">
                    <!-- Sidebar user panel (optional) -->
                    <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                        <div class="image">
                            <img src="./WEB-INF/icon.jpg" class="img-circle elevation-2" alt="User Image">
                        </div>
                        <div class="info">
                            <a class="d-block">Alexander Pierce</a>
                        </div>
                    </div>

                    <!-- Sidebar Menu -->
                    <nav class="mt-2">
                        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
                            <!-- Add icons to the links using the .nav-icon class
                               with font-awesome or any other icon font library -->
                            <li class="nav-item">
                                <a href="myItinerary1.html" class="nav-link">
                                    <i class="nav-icon fa fa-th"></i>
                                    <p>
                                        My Itinerary
                                    </p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <i class="nav-icon fa fa-pencil"></i>
                                    <p>
                                        Create Itinerary
                                    </p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="searchItinerary.html" class="nav-link">
                                    <i class="nav-icon fa fa-search"></i>
                                    <p>
                                        Search Itinerary
                                    </p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="pages/widgets.html" class="nav-link">
                                    <i class="nav-icon fa fa-user-circle"></i>
                                    <p>
                                        Profile
                                    </p>
                                </a>
                            </li>
                        </ul>
                    </nav>
                    <!-- /.sidebar-menu -->
                </div>
                <!-- /.sidebar -->
            </aside>

            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                <!-- Content Header (Page header) -->
                <div class="content-header">
                    <div class="container-fluid">
                        <div class="row mb-2">
                            <div class="col-sm-6">
                                <h1 class="m-0 text-dark">Profile</h1>
                            </div><!-- /.col -->

                        </div><!-- /.row -->
                    </div><!-- /.container-fluid -->
                </div>
                <!-- /.content-header -->

                <ul class="nav nav-tabs">
                    <li class="nav-item">
                        <a class="nav-link" href="viewProfile1.html">View Profile</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="#">Edit Details</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="editProfile1_login.html">Edit Login</a>
                    </li>
                </ul>

                <!-- Main content -->
                <section class="content">
                    <div class="container-fluid">
                        <br>
                        <form id="form" enctype="multipart/form-data">
                            <div class="form-row">
                                <div class="form-group col-md-3">
                                    <label for="username">Username</label>
                                    <input type="text" class="form-control" id="username" placeholder="Username" disabled>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="pic">Profile Picture</label> <br>
                                    <img id="dp" src="./WEB-INF/icon.jpg" width ="200">
                                    <div class="input-group mb-3">
                                        <div class="custom-file">
                                            <input type="file" class="custom-file-input" id="pic">
                                            <label class="custom-file-label" for="pic">Choose file</label>
                                        </div>
                                        <div class="input-group-apppend">
                                            <button class="btn btn-outline-secondary" type="button" id="upload">Upload</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="email">Email</label>
                                    <input type="email" class="form-control" id="email" placeholder="You didn't set your email">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="description">Description</label>
                                    <div class="md-form">
                                        <textarea id="description" class="md-textarea form-control" rows="3" placeholder="You don't have a description yet..."></textarea>
                                    </div>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group col-md-3">
                                    <label for="firstName">First Name</label>
                                    <input type="text" class="form-control" id="firstName" placeholder="-">
                                </div>
                                <div class="form-group col-md-3">
                                    <label for="lastnName">Last Name</label>
                                    <input type="text" class="form-control" id="lastName" placeholder="-">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group col-md-3">
                                    <label for="birthday">Birthday</label>
                                    <input type="date" class="form-control" id="birthday" placeholder="You didnt set your birthday yet...">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group col-md-4">
                                    <label for="blog">Blog</label>
                                    <input type="text" class="form-control" id="blog" placeholder="empty">
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="ig">Instagram</label>
                                    <input type="text" class="form-control" id="ig" placeholder="empty">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-3">
                                    <button type="button" type="submit" class="btn btn-primary btn-lg btn-block">Update Change</button>
                                </div>
                            </div>
                        </form>
                    </div><!-- /.container-fluid -->
                </section>
                <!-- /.content -->
            </div>
            <!-- /.content-wrapper -->
            <footer class="main-footer">
                footer here
            </footer>

            <!-- Control Sidebar -->
            <aside class="control-sidebar control-sidebar-dark">
                <!-- Control sidebar content goes here -->
            </aside>
            <!-- /.control-sidebar -->
        </div>
        <!-- ./wrapper -->

        <!-- jQuery -->
        <script src="plugins/jquery/jquery.min.js"></script>
        <!-- jQuery UI 1.11.4 -->
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
        <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
        <script>
            $.widget.bridge('uibutton', $.ui.button)
        </script>
        <!-- Bootstrap 4 -->
        <script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
        <!-- Sparkline -->
        <script src="plugins/sparkline/jquery.sparkline.min.js"></script>
        <!-- jvectormap -->
        <script src="plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
        <script src="plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
        <!-- jQuery Knob Chart -->
        <script src="plugins/knob/jquery.knob.js"></script>
        <!-- daterangepicker -->
        <script src="plugins/daterangepicker/daterangepicker.js"></script>
        <!-- datepicker -->
        <script src="plugins/datepicker/bootstrap-datepicker.js"></script>
        <!-- Bootstrap WYSIHTML5 -->
        <script src="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
        <!-- Slimscroll -->
        <script src="plugins/slimScroll/jquery.slimscroll.min.js"></script>
        <!-- FastClick -->
        <script src="plugins/fastclick/fastclick.js"></script>
        <!-- AdminLTE App -->
        <script src="dist/js/adminlte.js"></script>
    </body>

    <script>
            uId = sessionStorage.getItem('uId')

            document.getElementById("pic").onchange = function () {
                var reader = new FileReader();

                reader.onload = function (e) {
                    // get loaded data and render thumbnail.
                    document.getElementById("dp").src = e.target.result;
                };
                // read the image file as a data URL.
                reader.readAsDataURL(this.files[0]);
            };

//            $('#upload').click(function () {
//                uploadFile();
//            });
//
//            function uploadFile() {
//                var input = document.getElementById('pic');
//                // var file = $("#objFile")[0].files[0];
//                var file = input.files[0];
//                fr = new FileReader();
//                fr.onload = receivedText;
//                //fr.readAsText(file);
//                fr.readAsDataURL(file);
//            }
//
//            function receivedText() {
//                var b64Data = fr.result.split(',');
//                var contentType = 'image/jpeg';
//                //document.getElementById('editor').appendChild(document.createTextNode(fr.result))
//                var byteCharacters = atob(b64Data[1]);
//                var byteNumbers = Array.prototype.map.call(byteCharacters,
//                        charCodeFromCharacter);
//                var uint8Data = new Uint8Array(byteNumbers);
//                var blob_pic = b64toBlob(b64Data[1], contentType);
//                //var blobUrl = URL.createObjectURL(blob);
//                alert(blob_pic);
//                //alert(blobUrl);
//            }
//
//            function charCodeFromCharacter(c) {
//                return c.charCodeAt(0);
//            }
//
//            function b64toBlob(b64Data, contentType, sliceSize) {
//                contentType = contentType || '';
//                sliceSize = sliceSize || 1024;
//                var byteCharacters = atob(b64Data);
//                var byteArrays = [];
//
//                for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {
//                    var slice = byteCharacters.slice(offset, offset + sliceSize);
//                    var byteNumbers = Array.prototype.map.call(slice, charCodeFromCharacter);
//                    var byteArray = new Uint8Array(byteNumbers);
//                    byteArrays.push(byteArray);
//                }
////                for (var i = 0; i < byteArray.length; i++) {
////                    alert(byteArray[i]);
////                }
//
//            }


            $(document).ready(function () {
                $.get('http://localhost:8080/ItineraryPlanner-war/webresources/users/' + uId + '/' + uId, function (data) {
                    $("#firstName").val(data.firstName);
                    $("#lastName").val(data.lastName);
                    $("#username").val(data.userName);
                    $("#email").val(data.email);
                    $("#description").val(data.description);
                    $("#ig").val(data.instaURL);
                    $("#blog").val(data.blogURL);
                });

                $('#myform').submit(function () {

                    var currentDate = new Date();

                    var body = JSON.stringify({
                        "id": uId,
                        "firstName": $("#firstName").val(),
                        "lastName": $("#lastName").val(),
                        "email": $("#email").val(),
                        "profilepic": blob_pic,
                        "description": $("#description").val(),
                        "birthday": new Date($("#birthday").val()),
                        "instaURL": $("#instaURL").val(),
                        "blogURL": $("#blogURL").val(),
                        "createdDate": currentDate
                    })
                    console.log(body)

                    $.ajax({
                        type: "PUT",
                        url: 'http://localhost:8080/ItineraryPlanner-war/webresources/users/' + uId,
                        data: body,
                        contentType: "application/json; charset=utf-8",
                        success: function (data, textStatus, xhr)
                        {
                            console.log("Response: ", data)
                            console.log(textStatus)
                        },
                        error: function (xhr, error, errorType) {
                            console.log(body)
                            console.log(error);
                        }
                    });
                    return false;
                });

            });
    </script>